import{_ as n,o as s,c as a,b as e}from"./app-de7a4551.js";const t={},p=e(`<h1 id="wg-easy-安装" tabindex="-1"><a class="header-anchor" href="#wg-easy-安装" aria-hidden="true">#</a> wg-easy 安装</h1><h2 id="找目录添加-yml-文件-nano-home-ljw-docker-wg-easy-docker-compose-yml" tabindex="-1"><a class="header-anchor" href="#找目录添加-yml-文件-nano-home-ljw-docker-wg-easy-docker-compose-yml" aria-hidden="true">#</a> 找目录添加 yml 文件 (<code>nano /home/ljw/docker/wg-easy/docker-compose.yml</code>)</h2><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># https://github.com/WeeJeWel/wg-easy</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">wg-easy</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> weejewel/wg<span class="token punctuation">-</span>easy
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> wg<span class="token punctuation">-</span>easy
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> WG_HOST=8.134.xx.xx           <span class="token comment"># 自动填入的公网 IP</span>
      <span class="token punctuation">-</span> PASSWORD=xxxx  <span class="token comment"># 修改为你自己的管理密码</span>
      <span class="token punctuation">-</span> WG_DEFAULT_DNS=1.1.1.1
      <span class="token punctuation">-</span> AllowedIPs=0.0.0.0/0
      <span class="token punctuation">-</span> WG_PERSISTENT_KEEPALIVE=25
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;51820:51820/udp&quot;</span>   <span class="token comment"># WireGuard VPN 端口</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;51821:51821/tcp&quot;</span>   <span class="token comment"># Web 管理面板端口</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> .<span class="token punctuation">:</span>/etc/wireguard
    <span class="token key atrule">cap_add</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> NET_ADMIN
      <span class="token punctuation">-</span> SYS_MODULE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="启动容器" tabindex="-1"><a class="header-anchor" href="#启动容器" aria-hidden="true">#</a> 启动容器</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span> <span class="token comment"># -d 后台运行</span>
<span class="token comment"># docker compose down # 停止容器</span>
<span class="token comment"># docker logs -f wg-easy # 查看 wg-easy 日志</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="发现容器外-服务器无法-ping-通客户端" tabindex="-1"><a class="header-anchor" href="#发现容器外-服务器无法-ping-通客户端" aria-hidden="true">#</a> 发现容器外，服务器无法 ping 通客户端</h2><h3 id="方法1" tabindex="-1"><a class="header-anchor" href="#方法1" aria-hidden="true">#</a> 方法1</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>    network_mode: <span class="token function">host</span>   <span class="token comment"># ✅ 使用宿主机网络</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="方法2-默认-bridge-网络" tabindex="-1"><a class="header-anchor" href="#方法2-默认-bridge-网络" aria-hidden="true">#</a> 方法2 (默认 bridge 网络)</h3><p>然后在宿主机创建添加路由的脚本：</p><ol><li><p>在 /usr/local/bin/ 下创建一个名为 add-vpn-route.sh 的脚本文件：</p><ul><li><p><code>sudo nano /usr/local/bin/add-vpn-route.sh</code></p></li><li><p>脚本内容：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>    <span class="token comment">#!/bin/bash</span>

    <span class="token comment"># 等待容器启动最多 60 秒</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable">CONTAINER_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> inspect <span class="token parameter variable">-f</span> <span class="token string">&#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span> wg-easy <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$CONTAINER_IP</span>&quot;</span> <span class="token operator">=~</span> ^<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">\\</span>.<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">\\</span>.<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">\\</span>.<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+$ <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">break</span>
    <span class="token keyword">fi</span>
    <span class="token function">sleep</span> <span class="token number">2</span>
    <span class="token keyword">done</span>

    <span class="token comment"># 如果没获取到 IP，退出并报错</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$CONTAINER_IP</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Failed to get wg-easy container IP&quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token number">2</span>
    <span class="token keyword">fi</span>

    <span class="token comment"># 添加路由（忽略“已存在”的错误）</span>
    <span class="token comment"># 这告诉宿主机：“如果你想访问 10.8.0.0/24 网段（VPN 客户端），请发给容器 wg-easy。”</span>
    <span class="token function">sudo</span> <span class="token function">ip</span> route <span class="token function">add</span> <span class="token number">10.8</span>.0.0/24 via <span class="token string">&quot;<span class="token variable">$CONTAINER_IP</span>&quot;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token boolean">true</span>

    <span class="token comment"># 打印确认</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Route added to 10.8.0.0/24 via <span class="token variable">$CONTAINER_IP</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>赋予脚本执行权限： <code>sudo chmod +x /usr/local/bin/add-vpn-route.sh</code></p></li><li><p>添加到 systemd：</p><ul><li><p>创建一个新的 systemd 服务文件： <code>sudo nano /etc/systemd/system/add-vpn-route.service</code></p></li><li><p>在文件中添加以下内容：</p><div class="language-ini line-numbers-mode" data-ext="ini"><pre class="language-ini"><code>    <span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
    <span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">Add VPN route on startup</span>
    <span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>

    <span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
    <span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">oneshot</span>
    <span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/add-vpn-route.sh</span>
    <span class="token key attr-name">RemainAfterExit</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>

    <span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
    <span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>启用和启动服务：(启用并启动这个服务，以确保它会在每次启动时运行)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>    <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> add-vpn-route.service
    <span class="token function">sudo</span> systemctl start add-vpn-route.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>检查是否生效：(可以重启系统，看看是否成功添加了路由)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>    <span class="token function">sudo</span> systemctl status add-vpn-route.service
    <span class="token function">ip</span> route show
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol>`,11),l=[p];function i(c,o){return s(),a("div",null,l)}const d=n(t,[["render",i],["__file","wg_easy.html.vue"]]);export{d as default};
